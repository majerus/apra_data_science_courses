---
title: "Data Dictionary"
subtitle: APRA Data Science Courses
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, error=FALSE)

```

#  {.tabset .tabset-fade .tabset-pills} 

## Introduction 

This document describes the data created for [APRA's](https://www.aprahome.org/) fundraising data science online learning courses and workshops. All of the data created for these purposes is fictitious. 

There are three data sets available as of `r Sys.Date()`: 

- Biographical (donor level)
- Giving  (gift level)
- Engagement (donor level)

Each of these tables and the variables contained within each are described below. There are tabs included throughout the document that can be used to explore the variables included in each data set. 

These data sets are designed to mirror realistic fundraising data and are not intended to be perfectly "clean" data. 
There are common fundraising data challenges built into the data files. For example, you can click on the `Biographical Data` tab above to learn more about that data set. 

All of the code for this project is available on [GitHub](https://github.com/majerus/apra_data_science_courses). The code that generates the data sets can be found in the [generate_data.R](https://github.com/majerus/apra_data_science_courses/blob/master/generate_data.R) r script. 

The individual datasets can be read into R directly from github as follows.

```{r echo=TRUE, eval=FALSE}

# load the tidyverse library
library(tidyverse)

# read bio data csv into R and store in a data frame named bio
bio <- read_csv("https://raw.githubusercontent.com/majerus/apra_data_science_courses/master/bio_data_table.csv")

# read giving data csv into R and store in a data frame named giving
giving <- read_csv("https://raw.githubusercontent.com/majerus/apra_data_science_courses/master/giving_data_table.csv")

# read engagement data csv into R and store in a data frame named engage
#bio <- read_csv("https://raw.githubusercontent.com/majerus/apra_data_science_courses/master/bio_data_table.csv")

```



## Biographical Data {.tabset}


```{r}
# load tidyverse library 
library(tidyverse)
library(knitr)
library(plotly)
library(DT)

# read in biographical data from .csv file on github into a data frame in R called bio
# bio <- read_csv("https://raw.githubusercontent.com/majerus/apra_data_science_courses/master/bio_data_table.csv")
bio <- read_csv("bio_data_table.csv")
```

The biographical data has `r ncol(bio)` variables and `r prettyNum(nrow(bio), big.mark=",")` observations. The data is stored at the donor level. Each row of the data represents a unique donor and biographical information about that donor.  

### Numeric Variables

```{r, echo=FALSE}
# select only numeric variables from bio
numeric_variables <- 
  bio %>% 
  select_if(is.numeric) 
```

There are `r ncol(numeric_variables)` numeric variables:

- **id**: A seven digit numeric id that is unique to each donor.  
- **household_id**: A seven digit numeric id that is unique to households. More than one donor may share a household_id. 
- **lat**: The latitude of the center point of each donor's zipcode. Missing for donor's residing outside the United States.  
- **lon**: The longitude of the center point of each donor's zipcode. Missing for donor's residing outside the United States.

```{r}
# select and glimpse only numeric variables
bio %>% 
  select_if(is.numeric) %>% 
  glimpse()

```

### Character Variables {.tabset .tabset-fade .tabset-pills}

```{r, echo=FALSE}
# select only numeric variables from bio
character_variables <- 
  bio %>% 
  select_if(is.character) 
```

When loaded by default there are `r ncol(character_variables)` character variables:

- name: Each donor's first and last name formatted as "last name, first name".
- country: Each donor's country of residence. 
- city: Each donor's city of residence. 
- deceased: A binary indicator that indicates if a donor is deceased ("Y"|"N")
- zip: The five digit zipcode of donor's whose country of residence is the United States. 
- state: The two-letter state abbreviation for each donor whose country of residence is the United States. 
- capacity: Each donor's capacity represented within an estimated range. 
- capacity_source: A categorical variable indicating how the capacity was determined ("institutional"|"screening").
- race: a categorical variable indicating the donor's race. 

```{r}
# select and glimpse only character variables
bio %>% 
  select_if(is.character) %>%  
  glimpse()

```

```{r, echo=FALSE,include = FALSE}
# You need this code to conduct the magic dependences attaching...
# I usually forget this!!! But it is needed for generating DT tables in loops, etc. 
datatable(NULL)
plot_ly(mtcars)
```

```{r results='asis'}
# select character variables to be included in tables and plots
chars <- 
  bio %>% 
  select_if(is.character) %>% 
  select(-name, -city, -zip) %>% 
  colnames() 

# loop to create table and plot of counts of each character variable
# could replace this with purrr
for (i in chars) {
  
  current <- character_variables[, i]
  
  cat(paste("\n\n####", i, "\n"))
  
  print(htmltools::tagList(
    current %>%
      count(.data[[i]]) %>%
      datatable(rownames = FALSE),
    
    ggplotly(
      ggplot(current, aes_string(x = i)) +
        geom_bar(fill = '#1f77b4') +
        theme_minimal())
    
  ))
  
}


```

### Date Variables {.tabset .tabset-fade .tabset-pills}

```{r, echo=FALSE}
# select only numeric variables from bio
date_variables <- 
  bio %>% 
  select_if(function(x) inherits(x, 'Date'))
```

There is `r ncol(date_variables)` date variable:

- birthday: The date of each donor's birth stored as a date variable.

```{r}
# select and glimpse only date variable(s)
bio %>% 
  select_if(function(x) inherits(x, 'Date')) %>% 
  glimpse()

```

```{r results='asis'}
# select character variables to be included in tables and plots
ggplotly(
  ggplot(date_variables, aes(x = birthday)) +
    geom_histogram(fill = '#1f77b4') +
    theme_minimal())


```

## Giving Data {.tabset}
